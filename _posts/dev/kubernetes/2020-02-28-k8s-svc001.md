---
title: Kubernetes 기본 3-3
date: 2020-02-28 00:00:00 +0800
last_modified_at: 2020-08-22 00:00:00 +0800
excerpt: 서비스
categories: kubernetes
header:
  teaser: https://live.staticflickr.com/65535/49986203617_8b099459c5_k.jpg
  overlay_image: https://live.staticflickr.com/65535/49986203617_8b099459c5_k.jpg
  overlay_filter: 0.5
  og_image: https://live.staticflickr.com/65535/49986203617_8b099459c5_k.jpg
  caption: "Photo credit: [**Flickr***](https://live.staticflickr.com)"
---
### 서비스 개념

- 외부에서 파드에 접근하는 방법이 필요함
- 파드는 노드를 옮기면서 생성 되기도 하고 IP가 변경 되기 때문에 이러한 동적으로 변하는 파드에 고정적으로 접근하는 방법이 서비스임
- 참고로 서비스는 L4 영역에서 통신할 때 사용하고 나중에 학습할 인그레스는 L7 영역에서 통신할 때 사용함

### 서비스 타입

| 타입 | 설명 |
| --- | --- |
| ClusterIP | 기본 서비스 타입 | 
|           | 외부에서 접속 불가능 |
| NordPort | 서비스 하나에 모든 노드의 지정된 포트를 할당| 
|          | 지정된 포트만 사용하면 파드에 접근 가능 | 
|          | 외부에서 클러스터 안으로 접근 가능 |
| LoadBalancer | 퍼블릭 클라우드, OpenStack 등에서 지원하는 로드밸런서 장비 사용 |
|              | 로드밸런서와 파드를 연결한 후 해당 로드밸런서 IP를 이용하여 파드 접근 |
| ExternalName | 서비스를 .spec.externalName 필드에 설정한 값과 연결 |
|              | 클러스터 안에서 외부에 접근할 때 주로 사용 |

### 서비스 템플릿

```sh 
apiVersion: v1
kind: Service
metadata:
  name: whms-service
spec:
  type: ClusterIP
  clusterIP: 10.96.0.100
  selector:
    app: whms-deployment
  ports:
  - protocol: TCP
    port: 80
    targetPort: 8080
```

### ClusterIP 서비스 생성

템플릿을 통해 서비스 생성 및 테스트 컨테이너에서 서비스 IP 호출 테스트

<script id="asciicast-SRqZNcX4PAaY2ppBSmZCxYa8t" src="https://asciinema.org/a/SRqZNcX4PAaY2ppBSmZCxYa8t.js" async></script>

테스트 파드 생성 스크립트

```sh 
kubectl run -it --image nicolaka/netshoot testnet bash
```

### NodePort 서비스 생성

```sh 
apiVersion: v1
kind: Service
metadata:
  name: whms-nodeport
spec:
  type: NodePort
  selector:
    app: whms-deployment
  ports:
  - protocol: TCP
    port: 80
    targetPort: 8080
    nodePort: 30080
```

### LoadBalancer 서비스 생성

```sh 
apiVersion: v1
kind: Service
metadata:
  name: whms-loadbalancer
spec:
  type: LoadBalancer
  selector:
    app: whms-deployment
  ports:
  - protocol: TCP
    port: 80
    targetPort: 8080
    nodePort: 30080
```